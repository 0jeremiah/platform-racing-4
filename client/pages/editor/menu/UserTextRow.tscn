[gd_scene load_steps=2 format=3 uid="uid://clr1isblp5mfl"]

[sub_resource type="GDScript" id="GDScript_5l1xm"]
script/source = "extends SliderRow
class_name UserTextRow

signal level_event
signal control_event

static var selected_layer_name: String = \"L1\"

@onready var layers = get_node(\"../../../Layers\")
@onready var editor = get_node(\"../../../\")
@onready var menu = get_node(\"../\")

const SLIDER_TEXT_BUTTON: PackedScene = preload(\"res://pages/editor/menu/SliderTextButton.tscn\")
const USER_TEXT_ROW: PackedScene = preload(\"res://pages/editor/menu/UserTextRow.tscn\")
var layer_names: Array = []
var user_text_row


func _ready():
	super._ready()
	
	user_text_row = USER_TEXT_ROW.instantiate()
	menu.add_row(user_text_row)
	
	render()


func render():
	# remove existing buttons
	pos = Vector2i(0, 0)
	for existing_button in get_children():
		existing_button.queue_free()
		
	# add a button for each layer
	for layer in layers.get_children():
		var layer_name = layer.name
		var button = SLIDER_TEXT_BUTTON.instantiate()
		add_slider(button)
		button.set_label(layer_name)
		button.connect(\"pressed\", _on_pressed)
	
	# add a button to add new layers
	var button = SLIDER_TEXT_BUTTON.instantiate()
	add_slider(button)
	button.set_label(\"+\")
	button.connect(\"pressed\", _on_new_pressed)
	
	# select the currently active layer
	select(selected_layer_name)
	user_text_row.layer_name = selected_layer_name


func select(label: String) -> void:
	selected_layer_name = label
	user_text_row.set_layer_name(selected_layer_name)
	for button in get_children():
		if button.get_label() == label:
			button.set_focus(true)
		else:
			button.set_focus(false)


func _on_pressed(label: String) -> void:
	select(label)
	emit_signal(\"control_event\", {
		\"type\": EditorEvents.SELECT_LAYER,
		\"layer_name\": label
	})


func _on_new_pressed(label: String) -> void:
	emit_signal(\"level_event\", {
		\"type\": EditorEvents.ADD_LAYER,
		\"name\": \"L\" + str(layers.get_child_count() + 1)
	})
	call_deferred(\"render\")


func _exit_tree():
	if user_text_row:
		user_text_row.queue_free()
		user_text_row = null
"

[node name="UserTextRow" type="Node2D"]
script = SubResource("GDScript_5l1xm")
